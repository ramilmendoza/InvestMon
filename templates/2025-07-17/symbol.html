<!-- templates/symbol.html -->
{% extends "base.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1 class="futuristic-header">{{ symbol }} - STOCK ANALYSIS</h1>
        <div class="futuristic-divider"></div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-6">
        <div class="card futuristic-card">
            <div class="card-header futuristic-card-header">
                <i class="bi bi-graph-up me-2"></i> CURRENT PRICE
                <span class="futuristic-badge">{{ latest.date }}</span>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="futuristic-data-item">
                            <span class="data-label">OPEN</span>
                            <span class="data-value">{{ "%.2f"|format(latest.open) if latest.open else '-' }}</span>
                        </div>
                        <div class="futuristic-data-item">
                            <span class="data-label">HIGH</span>
                            <span class="data-value">{{ "%.2f"|format(latest.high) if latest.high else '-' }}</span>
                        </div>
                        <div class="futuristic-data-item">
                            <span class="data-label">LOW</span>
                            <span class="data-value">{{ "%.2f"|format(latest.low) if latest.low else '-' }}</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="futuristic-data-item">
                            <span class="data-label">CLOSE</span>
                            <span class="data-value {% if latest.close > latest.open %}price-up{% elif latest.close < latest.open %}price-down{% endif %}">
                                {{ "%.2f"|format(latest.close) if latest.close else '-' }}
                            </span>
                        </div>
                        <div class="futuristic-data-item">
                            <span class="data-label">CHANGE</span>
                            <span class="data-value {% if latest.close > latest.open %}price-up{% elif latest.close < latest.open %}price-down{% endif %}">
                                {% if latest.open and latest.close %}
                                    {{ "%+.2f"|format(((latest.close - latest.open) / latest.open * 100)) }}%
                                {% else %}
                                    -
                                {% endif %}
                            </span>
                        </div>
                        <div class="futuristic-data-item">
                            <span class="data-label">VOLUME</span>
                            <span class="data-value">{{ "{:,.0f}".format(latest.volume) if latest.volume else '-' }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card futuristic-card">
            <div class="card-header futuristic-card-header">
                <i class="bi bi-lightning-charge me-2"></i> PERFORMANCE SUMMARY
            </div>
            <div class="card-body">
                <div class="futuristic-stats">
                    <div class="stat-item">
                        <div class="stat-label">52-WEEK HIGH</div>
                        <div class="stat-value text-success">{{ "%.2f"|format(high_52w) if high_52w else '-' }}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">52-WEEK LOW</div>
                        <div class="stat-value text-danger">{{ "%.2f"|format(low_52w) if low_52w else '-' }}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">AVG VOLUME</div>
                        <div class="stat-value">{{ "{:,.0f}".format(avg_volume) if avg_volume else '-' }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col">
        <div class="card futuristic-card">
            <div class="card-header futuristic-card-header">
                <i class="bi bi-bar-chart-line me-2"></i> PRICE HISTORY
            </div>
            <div class="card-body">
                <div id="price-chart" class="futuristic-chart">
                    {{ chart_html|safe }}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col">
        <div class="card futuristic-card">
            <div class="card-header futuristic-card-header">
                <i class="bi bi-speedometer2 me-2"></i> TRADING VOLUME
            </div>
            <div class="card-body">
                <div id="volume-chart" class="futuristic-chart">
                    {{ vol_chart_html|safe }}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .futuristic-header {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        font-weight: 700;
        letter-spacing: 1px;
        text-transform: uppercase;
        color: #20c997;
        text-shadow: 0 0 10px rgba(32, 201, 151, 0.5);
        margin-bottom: 1rem;
    }
    
    .futuristic-divider {
        height: 3px;
        background: linear-gradient(90deg, transparent, #20c997, transparent);
        margin-bottom: 2rem;
    }
    
    .futuristic-card {
        background: linear-gradient(145deg, #1a1e23, #22272e);
        border: 1px solid #2a3038;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        color: #e9ecef;
        margin-bottom: 1.5rem;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        overflow: hidden;
    }
    
    .futuristic-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 25px rgba(32, 201, 151, 0.2);
    }
    
    .futuristic-card-header {
        background: linear-gradient(90deg, #1c2127, #242a32);
        border-bottom: 1px solid #2a3038;
        font-weight: 600;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        padding: 1rem 1.5rem;
        color: #20c997;
        display: flex;
        align-items: center;
    }
    
    .futuristic-badge {
        background: rgba(32, 201, 151, 0.15);
        border: 1px solid rgba(32, 201, 151, 0.3);
        border-radius: 20px;
        padding: 0.25rem 0.75rem;
        font-size: 0.8rem;
        margin-left: auto;
    }
    
    .futuristic-data-item {
        display: flex;
        justify-content: space-between;
        padding: 0.75rem 0;
        border-bottom: 1px solid #2a3038;
    }
    
    .data-label {
        color: #8a94a5;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.9rem;
    }
    
    .data-value {
        font-weight: 600;
        font-size: 1.1rem;
    }
    
    .futuristic-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1.5rem;
        margin-top: 1rem;
    }
    
    .stat-item {
        background: rgba(32, 201, 151, 0.08);
        border: 1px solid rgba(32, 201, 151, 0.15);
        border-radius: 10px;
        padding: 1rem;
        text-align: center;
        transition: transform 0.3s ease;
    }
    
    .stat-item:hover {
        transform: translateY(-3px);
        background: rgba(32, 201, 151, 0.12);
    }
    
    .stat-label {
        color: #8a94a5;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.5rem;
    }
    
    .stat-value {
        font-weight: 700;
        font-size: 1.4rem;
    }
    
    .futuristic-chart {
        background: #1a1e23;
        border-radius: 8px;
        border: 1px solid #2a3038;
        padding: 15px;
        margin-top: 1rem;
        position: relative;
        overflow: hidden;
    }
    
    /* Add futuristic glow to chart containers */
    .futuristic-chart::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, #20c997, #0d6efd, #20c997);
        z-index: -1;
        filter: blur(10px);
        opacity: 0.4;
        border-radius: 10px;
    }
    
    .price-up {
        color: #20c997 !important;
        text-shadow: 0 0 8px rgba(32, 201, 151, 0.4);
    }
    
    .price-down {
        color: #ff6b6b !important;
        text-shadow: 0 0 8px rgba(255, 107, 107, 0.4);
    }
    
    /* Enhanced Bokeh charts for dark mode */
    .bk-root .bk-tooltip {
        background-color: #1e2229 !important;
        border: 1px solid #2a3038 !important;
        color: #e9ecef !important;
        box-shadow: 0 0 15px rgba(32, 201, 151, 0.3);
    }
    
    .bk-root .bk-tooltip>div:not(:first-child) {
        border-top: 1px solid #2a3038 !important;
    }
    
    .bk-root .bk-axis-label {
        color: #8a94a5 !important;
        text-shadow: 0 0 5px rgba(138, 148, 165, 0.3);
    }
    
    .bk-root .bk-major-tick line {
        stroke: #2a3038 !important;
    }
    
    .bk-root .bk-legend {
        background-color: rgba(30, 34, 41, 0.8) !important;
        border: 1px solid #2a3038 !important;
        border-radius: 8px !important;
        padding: 8px !important;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5) !important;
    }
    
    .bk-root .bk-legend-item {
        color: #e9ecef !important;
    }
    
    .bk-root .bk-canvas {
        background-color: transparent !important;
    }
    
    /* Chart glow effect */
    .bk-root .bk-plot {
        filter: drop-shadow(0 0 8px rgba(32, 201, 151, 0.2));
    }
    
    /* Volume chart specific styling */
    #volume-chart .bk-root .bk-tooltip {
        background-color: #1e2229 !important;
        border: 1px solid #2a3038 !important;
        color: #e9ecef !important;
        box-shadow: 0 0 15px rgba(13, 110, 253, 0.3);
    }
    
    #volume-chart .futuristic-chart::before {
        background: linear-gradient(45deg, #0d6efd, #20c997, #0d6efd);
    }
    
    /* Price chart specific styling */
    #price-chart .bk-root .bk-tooltip {
        background-color: #1e2229 !important;
        border: 1px solid #2a3038 !important;
        color: #e9ecef !important;
        box-shadow: 0 0 15px rgba(32, 201, 151, 0.3);
    }
    
    #price-chart .futuristic-chart::before {
        background: linear-gradient(45deg, #20c997, #0d6efd, #20c997);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add futuristic glow effect to cards on hover
        const cards = document.querySelectorAll('.futuristic-card');
        cards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.boxShadow = '0 6px 25px rgba(32, 201, 151, 0.25)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.5)';
            });
        });
        
        // Add glow effect to chart containers
        const charts = document.querySelectorAll('.futuristic-chart');
        charts.forEach(chart => {
            chart.addEventListener('mouseenter', function() {
                this.style.boxShadow = '0 0 20px rgba(32, 201, 151, 0.3)';
                this.style.borderColor = '#20c997';
            });
            
            chart.addEventListener('mouseleave', function() {
                this.style.boxShadow = 'none';
                this.style.borderColor = '#2a3038';
            });
        });
        
        // Add subtle animation to chart containers
        setInterval(() => {
            charts.forEach(chart => {
                const glowIntensity = 0.2 + Math.random() * 0.1;
                chart.style.boxShadow = `0 0 ${10 + Math.random() * 10}px rgba(32, 201, 151, ${glowIntensity})`;
            });
        }, 2000);
    });
</script>
{% endblock %}